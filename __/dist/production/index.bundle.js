!function(e,t){for(var i in t)e[i]=t[i]}(this,function(i){var s={};function a(e){if(s[e])return s[e].exports;var t=s[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,a),t.l=!0,t.exports}return a.m=i,a.c=s,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)a.d(i,s,function(e){return t[e]}.bind(null,s));return i},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=3)}([function(e,t){!function(){e.exports=this.React}()},function(e,t,i){function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var s=znui.React||i(0),a=znui.ReactDOM||i(4);e.exports=znui.react.createClass({displayName:"AjaxUploader",getDefaultProps:function(){return{name:"zr_ajax_uploader_file",action:"/zxnz.core.fs/upload/files",types:[],changeSubmit:!0,hiddens:null,multiple:!0,hint:!1,maxFileSize:524288e3,size:""}},getInitialState:function(){return{host:this.props.host||zn.setting.path("zr.uploader.host"),loading:!1,files:[],progress:0,timeStamp:0}},__onInputChange:function(e){if(this.state.loading)return!1;this.state.files=[];var t=e.nativeEvent.target.files,i=null;if(!t.length)return alert("未选择文件");for(var s=0,a=t.length;s<a;s++){if((i=t[s]).size>this.props.maxFileSize)return alert(i.name+" 文件大小是"+znui.react.stringifyFileSize(i.size)+", 不能超过"+znui.react.stringifyFileSize(this.props.maxFileSize)),e.nativeEvent.target.form.reset(),!1;if(this.props.types.length&&-1==this.props.types.indexOf(i.type.split("/")[0]))return alert("只支持"+this.props.types.join(",")+"的文件类型"),!1;this.state.files.push(i)}var n=this.props.onChange&&this.props.onChange(this.state.files,this);!1!==n&&this.props.changeSubmit&&this.submit(this.state.files,n)},__onInputClick:function(e){if(this.state.loading)return!1;e.stopPropagation(),this.props.onUploaderClick&&this.props.onUploaderClick(e,this)},submit:function(e,t){var i=e||this.state.files,s=new FormData,a=this.props.hiddens||{},n=null;zn.is(t,"object")&&zn.extend(a,t);for(var r=0,o=i.length;r<o;r++)s.append(this.props.name+"_"+r,i[r]);for(var l in a)"object"==p(n=a[l])&&(n=JSON.stringify(n)),s.append(l,n);this.ajaxUpload(s)},ajaxUpload:function(e){var t=this.state.host||zn.setting.path("zr.uploader.uploadHost"),i=this.props.action||this.props.uploadApi||zn.setting.path("zr.uploader.uploadApi");if(!(i=t+i))return console.error("文件上传接口未输入"),!1;this.setState({loading:!0});var s=new XMLHttpRequest;s.upload.addEventListener("progress",this.__ajaxUploadProgress,!1),s.addEventListener("load",this.__ajaxUploadComplete,!1),s.addEventListener("error",this.__ajaxUploadError,!1),s.addEventListener("abort",this.__ajaxUploadAbort,!1),s.open("POST",i,"true"),s.send(e)},__ajaxUploadProgress:function(e){e.lengthComputable&&(e.progress=Math.round(100*e.loaded/e.total),this.state.progress=e.progress,this.state.timeStamp=e.timeStamp,this.forceUpdate()),this.props.onUploading&&this.props.onUploading(e,this)},__ajaxUploadComplete:function(e){if(this.reset(),this.state.progress=0,this.state.timeStamp=0,this.forceUpdate(),0==e.target.responseText.indexOf("<!DOCTYPE html>"))return alert(e.target.responseText),!1;if(0==e.target.responseText.indexOf("{")||0==e.target.responseText.indexOf("[")){var t=JSON.parse(e.target.responseText);200==t.code?this.props.onComplete&&this.props.onComplete(t.result,this):this.props.onError&&this.props.onError(t.result,this)}},__ajaxUploadError:function(e){this.reset(),this.props.onError&&this.props.onError(e.message,this)},__ajaxUploadAbort:function(e){this.reset(),this.props.onAbort&&this.props.onAbort(e,this)},reset:function(){this.setState({loading:!1}),a.findDOMNode(this).reset()},__renderProcess:function(){if(this.state.progress)return 100==this.state.progress?s.createElement("div",{className:"upload-progress",style:{height:"100%"}},s.createElement("svg",{"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"check",className:"svg-inline--fa fa-check fa-w-16 ",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},s.createElement("path",{fill:"currentColor",d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"}))):s.createElement("div",{className:"upload-progress",style:{height:this.state.progress+"%"}},this.state.progress+"%","(",(this.state.timeStamp/1e3).toFixed(1),"s)")},render:function(){var e=this.state.host||zn.setting.path("zr.uploader.uploadHost"),t=this.props.action||this.props.uploadApi||zn.setting.path("zr.uploader.uploadApi");return(t=e+t)||console.error("文件上传接口未输入"),s.createElement("form",{className:znui.react.classname("zr-ajax-uploader",this.props.className),"data-loading":this.state.loading,action:t,encType:"multipart/form-data",method:"POST"},this.__renderProcess(),s.createElement("div",{className:"ajax-upload-container"},this.props.children),this.props.hint&&s.createElement("span",{className:"size"},this.props.size+" "+znui.react.stringifyFileSize(this.props.maxFileSize)),s.createElement("input",{multiple:this.props.multiple,className:"input",type:"file",name:this.props.name||"zr_ajax_uploader_file_"+Date.now(),onChange:this.__onInputChange,onClick:this.__onInputClick}),s.createElement("div",{className:"ajax-upload-icon"},s.createElement("svg",{"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"upload",className:"svg-inline--fa fa-upload fa-w-16 ",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},s.createElement("path",{fill:"currentColor",d:"M296 384h-80c-13.3 0-24-10.7-24-24V192h-87.7c-17.8 0-26.7-21.5-14.1-34.1L242.3 5.7c7.5-7.5 19.8-7.5 27.3 0l152.2 152.2c12.6 12.6 3.7 34.1-14.1 34.1H320v168c0 13.3-10.7 24-24 24zm216-8v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h136v8c0 30.9 25.1 56 56 56h80c30.9 0 56-25.1 56-56v-8h136c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"}))))}})},function(e,t,i){function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=znui.React||i(0);e.exports=znui.react.createClass({displayName:"FileViewer",getDefaultProps:function(){return{valueKey:"tempName",width:480,height:320}},getInitialState:function(){return{host:this.props.host||zn.setting.path("zr.uploader.host"),fullScreen:!1,files:[]}},componentDidMount:function(){!1!==(this.props.didMount&&this.props.didMount(this))&&this.initValue(this.props.value)},initValue:function(e){if(e){if(zn.is(e,"object"))return this.setFile(e),!1;if(zn.is(e,"string")){var t=this.state.host,i=this.props.fetchApi||zn.setting.path("zr.uploader.fetchApi");if(!(i=t+i))return console.error("文件验证接口未输入"),!1;zn.data.get(i+e).then(function(e){zn.is(e,"array")?this.setFiles(e):zn.is(e,"object")&&200==e.status&&"object"==s(e.data)&&200==e.data.code&&zn.is(e.data.result,"array")&&this.setFiles(e.data.result)}.bind(this),function(){})}}},setFile:function(e){this.state.file=e,this.forceUpdate()},__fileDownloadRender:function(e){var t=this,i=this.state.host||zn.setting.path("zr.uploader.downloadHost"),s=this.props.downloadApi||zn.setting.path("zr.uploader.downloadApi");if(s=i+s)return a.createElement("span",{onClick:function(){return znui.downloadURL(s+e[t.props.valueKey],e.name)},className:"download"},a.createElement("svg",{"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"download",className:"svg-inline--fa fa-download fa-w-16 ",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},a.createElement("path",{fill:"currentColor",d:"M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"})))},__renderFileContent:function(e){var t=null,i="";return 0==e.type.indexOf("image")?(i=(this.props.host||zn.setting.path("zr.uploader.host")||"")+(zn.setting.path("zr.uploader.fetchImageApi")||"")+e[this.props.valueKey],t=a.createElement("img",{style:{width:"100%",height:"auto"},className:"view img-view",src:i})):0==e.type.indexOf("video")&&(i=(this.props.host||zn.setting.path("zr.uploader.host")||"")+(zn.setting.path("zr.uploader.fetchImageApi")||"")+e[this.props.valueKey],t=a.createElement("video",{className:"view ideo-view",controls:!0,preload:"auto",width:this.props.width,height:this.props.height,poster:this.props.poster},a.createElement("source",{src:i,type:"video/mp4"}),a.createElement("source",{src:i,type:"video/webm"}),a.createElement("p",{className:"tips"},"To view this video please enable JavaScript, and consider upgrading to a web browser that",a.createElement("a",{href:"https://videojs.com/html5-video-support/",target:"_blank"},"supports HTML5 video")))),a.createElement("div",{className:"file-view"},t)},__fullScreen:function(){this.setState({fullScreen:!this.state.fullScreen})},render:function(){var e=this,t=this.state.file;return t?a.createElement("div",{className:znui.react.classname("zr-file-viewer",this.props.className,this.state.fullScreen?"full-screen":""),style:znui.react.style(this.props.style)},a.createElement("div",{className:"file-info"},this.state.fullScreen?a.createElement("svg",{onClick:this.__fullScreen,"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"window-close",className:"svg-inline--fa fa-window-close fa-w-16 ",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},a.createElement("path",{fill:"currentColor",d:"M464 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-83.6 290.5c4.8 4.8 4.8 12.6 0 17.4l-40.5 40.5c-4.8 4.8-12.6 4.8-17.4 0L256 313.3l-66.5 67.1c-4.8 4.8-12.6 4.8-17.4 0l-40.5-40.5c-4.8-4.8-4.8-12.6 0-17.4l67.1-66.5-67.1-66.5c-4.8-4.8-4.8-12.6 0-17.4l40.5-40.5c4.8-4.8 12.6-4.8 17.4 0l66.5 67.1 66.5-67.1c4.8-4.8 12.6-4.8 17.4 0l40.5 40.5c4.8 4.8 4.8 12.6 0 17.4L313.3 256l67.1 66.5z"})):a.createElement("svg",{onClick:this.__fullScreen,"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"tv",className:"svg-inline--fa fa-tv fa-w-20 ",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 512"},a.createElement("path",{fill:"currentColor",d:"M592 0H48A48 48 0 0 0 0 48v320a48 48 0 0 0 48 48h240v32H112a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16H352v-32h240a48 48 0 0 0 48-48V48a48 48 0 0 0-48-48zm-16 352H64V64h512z"})),this.__fileDownloadRender(t),a.createElement("a",{className:"link",onClick:function(){return e.__onPreview(t)}},t.name),a.createElement("span",{className:"size"},znui.react.stringifyFileSize(+t.size))),this.__renderFileContent(t)):null}})},function(e,t,i){zn.setting.setKey("zr.uploader",zn.deepAssign({},zn.setting.getKey("zr.uploader"),{uploadApi:"/zxnz.core.fs/upload/files",fetchApi:"/zxnz.core.fs/fetch/file/",fetchsApi:"/zxnz.core.fs/fetch/files/",fetchImageApi:"/zxnz.core.fs/fetch/image/",downloadApi:"/zxnz.core.fs/download/file/"})),e.exports={AjaxUploader:i(1),FileUploader:i(5),FileViewer:i(2),FilesViewer:i(6),ImageUploader:i(7)}},function(e,t){!function(){e.exports=this.ReactDOM}()},function(e,t,i){function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}).apply(this,arguments)}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){var i;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return l(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);function s(){}var a=0;return{s:s,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,r=!0,o=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return r=e.done,e},e:function(e){o=!0,n=e},f:function(){try{r||null==i.return||i.return()}finally{if(o)throw n}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}var n=znui.React||i(0),r=i(1);e.exports=znui.react.createClass({displayName:"FileUploader",getDefaultProps:function(){return{valueKey:"tempName",editable:!0,compress:{maxWidth:1024,maxHeight:768,quality:1}}},getInitialState:function(){return{host:this.props.host||zn.setting.path("zr.uploader.host"),value:[],files:[],compressing:!1}},componentDidMount:function(){!1!==(this.props.didMount&&this.props.didMount(this))&&this.initValue(this.props.value)},__onChange:function(e,t){if(this.props.compress){var i=[],s=zn.queue({},{every:function(e,t){i.push(t)},finally:function(e){this.setState({compressing:!1}),t.submit(i)}.bind(this)}),a=zn.extend({maxWidth:1024,maxHeight:768,quality:1},this.props.compress),n=new FileReader,r=new Image;n.onload=function(e){r.src=e.target.result},this.setState({compressing:!0});var o,l=c(e);try{for(l.s();!(o=l.n()).done;){var p=o.value;(0===p.type.indexOf("image")?function(i){s.push(function(t){n.readAsDataURL(i),r.onload=function(){znui.imageToCanvas(r,a.maxWidth,a.maxHeight).toBlob(function(e){t.done(new File([e],i.name,{lastModifiedDate:(new Date).getTime(),type:i.type}))},i.type,a.quality)}})}:function(t){s.push(function(e){e.done(t)})})(p)}}catch(e){l.e(e)}finally{l.f()}return s.start(),!1}this.props.onUploaderChange&&this.props.onUploaderChange(e,t,this)},initValue:function(e){if(e){var t=this.state.host,i=this.props.fetchsApi||zn.setting.path("zr.uploader.fetchsApi");if(!(i=t+i))return console.error("文件验证接口未输入"),!1;zn.is(e,"array")&&(e=e.join(",")),zn.data.get(i+e).then(function(e){zn.is(e,"array")?this.setFiles(e):zn.is(e,"object")&&200==e.status&&"object"==a(e.data)&&200==e.data.code&&zn.is(e.data.result,"array")&&this.setFiles(e.data.result)}.bind(this),function(){})}},__onComplete:function(e,t){this.setFiles(e),this.props.onChange&&this.props.onChange({value:this.state.value},this),this.props.onComplete&&this.props.onComplete(e,t,this)},setFiles:function(e){var t=this.props.valueKey,i=(e||[]).map(function(e){if(e&&e[t])return e[t]});this.state.value=this.state.value.concat(i),this.state.files=this.state.files.concat(e),this.forceUpdate()},getValue:function(){return this.state.value},setValue:function(e){this.setState({value:e})},__onFileClick:function(e,t){this.props.onFileClick&&this.props.onFileClick(e,t)},__onRemove:function(e,t){this.state.files.splice(t,1),this.state.value.splice(t,1),this.forceUpdate(),this.props.onChange&&this.props.onChange({file:e,index:t,value:this.state.value,files:this.state.files},this)},__fileDownloadRender:function(e){var t=this,i=this.state.host||zn.setting.path("zr.uploader.downloadHost"),s=this.props.downloadApi||zn.setting.path("zr.uploader.downloadApi");if(s=i+s)return n.createElement("span",{onClick:function(){return znui.downloadURL(s+e[t.props.valueKey],e.name)},className:"download"},n.createElement("svg",{"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"download",className:"svg-inline--fa fa-download fa-w-16 ",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},n.createElement("path",{fill:"currentColor",d:"M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"})))},__renderFiles:function(){if(this.state.files){var a=this.props.editable&&!this.props.disabled&&!this.props.readonly;return n.createElement("ul",{className:"file-list"},this.state.files.map(function(e,t){var i=this;if(e){var s=this.props.onFileRender&&this.props.onFileRender(e,t);return s?s:n.createElement("li",{key:e[this.props.valueKey],className:"file"},a&&n.createElement("svg",{"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"trash-alt",onClick:function(){return i.__onRemove(e,t)},className:"svg-inline--fa fa-remove zr-hover-self-loading fa-trash-alt fa-w-14 ",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"},n.createElement("path",{fill:"currentColor",d:"M32 464a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128H32zm272-256a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zM432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16z"})),this.__fileDownloadRender(e,t),n.createElement("a",{className:"link",onClick:function(){return i.__onFileClick(e,t)}},e.name),n.createElement("span",{className:"size"},znui.react.stringifyFileSize(+e.size)))}}.bind(this)))}},render:function(){var e=this.props.editable&&!this.props.disabled&&!this.props.readonly;return n.createElement("div",{className:znui.react.classname("zr-file-uploader",this.props.className)},e&&n.createElement(r,s({},this.props,{style:this.props.uploaderStyle,onChange:this.__onChange,onComplete:this.__onComplete}),n.createElement("div",{className:"upload-container",style:this.props.style},n.createElement("div",{className:"file-upload-icon"},n.createElement("svg",{"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"file-upload",className:"svg-inline--fa fa-file-upload fa-w-12 ",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512"},n.createElement("path",{fill:"currentColor",d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm65.18 216.01H224v80c0 8.84-7.16 16-16 16h-32c-8.84 0-16-7.16-16-16v-80H94.82c-14.28 0-21.41-17.29-11.27-27.36l96.42-95.7c6.65-6.61 17.39-6.61 24.04 0l96.42 95.7c10.15 10.07 3.03 27.36-11.25 27.36zM377 105L279.1 7c-4.5-4.5-10.6-7-17-7H256v128h128v-6.1c0-6.3-2.5-12.4-7-16.9z"})),this.state.compressing&&n.createElement("span",{className:"compressing"},"压缩中...")))),this.__renderFiles())}})},function(e,t,i){function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=znui.React||i(0),n=i(2);e.exports=znui.react.createClass({displayName:"FilesViewer",getDefaultProps:function(){return{valueKey:"tempName",width:480,height:320}},getInitialState:function(){return{host:this.props.host||zn.setting.path("zr.uploader.host"),files:[]}},componentDidMount:function(){!1!==(this.props.didMount&&this.props.didMount(this))&&this.initValue(this.props.value)},initValue:function(e){if(e){if(zn.is(e[0],"object"))return this.setFiles([e]),!1;if(zn.is(e,"array")&&e.length&&zn.is(e[0],"object"))return this.setFiles(e),!1;var t=this.state.host,i=this.props.fetchsApi||zn.setting.path("zr.uploader.fetchsApi");if(!(i=t+i))return console.error("FilesViewer.js 文件验证接口未输入"),!1;zn.is(e,"array")&&(e=e.join(",")),zn.data.get(i+e).then(function(e){zn.is(e,"array")?this.setFiles(e):zn.is(e,"object")&&200==e.status&&"object"==s(e.data)&&200==e.data.code&&zn.is(e.data.result,"array")&&this.setFiles(e.data.result)}.bind(this),function(){})}},setFiles:function(e){this.state.files=e,this.forceUpdate()},__renderFiles:function(){if(this.state.files)return a.createElement("div",{className:"file-list"},this.state.files.map(function(e,t){if(e){var i=this.props.onFileRender&&this.props.onFileRender(e,t);return i?i:a.createElement(n,{key:t,width:this.props.width,height:this.props.height,value:e,valueKey:this.props.valueKey})}}.bind(this)))},render:function(){return a.createElement("div",{className:znui.react.classname("zr-files-viewer",this.props.className),style:znui.react.style(this.props.style)},this.__renderFiles())}})},function(e,t,i){function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}).apply(this,arguments)}var a=znui.React||i(0),n=i(1);e.exports=a.createClass({displayName:"ImageUploader",getDefaultProps:function(){return{value:"",compress:{maxWidth:1024,maxHeight:768,quality:1}}},getInitialState:function(){return{value:this.props.value,imageDataURL:null,original:null,compress:null,compressing:!1}},__onChange:function(e,i){var s=e[0];if(-1==s.type.indexOf("image"))return alert(s.name+" 不是图片文件"),!1;if(!FileReader||!Image)return alert("浏览器不支持预览功能"),!1;if(this.props.compress){this.setState({compressing:!0});var a=this,n=zn.extend({maxWidth:1024,maxHeight:768,quality:1},this.props.compress),t=new FileReader,r=new Image;return t.onload=function(e){r.src=e.target.result},t.readAsDataURL(s),!(r.onload=function(){a.state.original={size:znui.react.stringifyFileSize(s.size),width:r.width,height:r.height};var t=znui.imageToCanvas(r,n.maxWidth,n.maxHeight);a.state.imageDataURL=t.toDataURL(s.type,n.quality),t.toBlob(function(e){a.state.compressing=!1,e&&(a.state.compress={size:znui.react.stringifyFileSize(e.size),width:t.width,height:t.height},i.submit([new File([e],s.name,{lastModifiedDate:(new Date).getTime(),type:s.type})])),a.forceUpdate()},s.type,n.quality)})}(t=new FileReader).onload=function(e){this.setState({imageDataURL:e.target.result})}.bind(this),t.readAsDataURL(s)},__onComplete:function(e){var t=e[0];t&&this.setValue(t[this.props.valueKey||"savedName"]),this.props.onComplete&&this.props.onComplete(t,this)},getValue:function(){return this.state.value},setValue:function(e){this.setState({value:e},function(){this.props.onChange&&this.props.onChange({value:e},this)}.bind(this))},__renderImage:function(){var e=this.state.imageDataURL;return e||(e=this.state.value)&&0!=e.indexOf("http")&&(e=-1!=e.indexOf("/")?(this.props.host||zn.setting.path("zr.uploader.host")||"")+e:(this.props.host||zn.setting.path("zr.uploader.host")||"")+(zn.setting.path("zr.uploader.fetchImageApi")||"")+e),e?a.createElement("img",{className:"img",src:e}):a.createElement("div",{className:"img-upload-icon"},a.createElement("svg",{"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"image",className:"svg-inline--fa fa-image fa-w-16 ",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},a.createElement("path",{fill:"currentColor",d:"M464 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h416c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM112 120c-30.928 0-56 25.072-56 56s25.072 56 56 56 56-25.072 56-56-25.072-56-56-56zM64 384h384V272l-87.515-87.515c-4.686-4.686-12.284-4.686-16.971 0L208 320l-55.515-55.515c-4.686-4.686-12.284-4.686-16.971 0L64 336v48z"})))},render:function(){return a.createElement(n,s({},this.props,{className:znui.react.classname("zr-image-uploader",this.props.className),onChange:this.__onChange,onComplete:this.__onComplete,multiple:!1}),a.createElement("div",{className:"image-container",style:this.props.style},this.__renderImage(),this.state.compress&&a.createElement("div",{className:"compress-info"},a.createElement("div",{className:"original"},"压缩前：",this.state.original.width," x ",this.state.original.height," (",this.state.original.size,")"),a.createElement("div",{className:"compress"},"压缩后：",this.state.compress.width," x ",this.state.compress.height," (",this.state.compress.size,")")),this.state.compressing&&a.createElement("span",{className:"compressing"},"压缩中...")))}})}]));